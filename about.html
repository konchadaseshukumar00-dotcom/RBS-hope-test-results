<!DOCTYPE html>
<html>
<head>
<title>Student Details</title>
<style>
body{font-family:Arial;background:#eef2f3;margin:0;}
.header{background:#0b5394;color:white;padding:15px;}
.box{
 background:white;width:900px;margin:30px auto;
 padding:20px;border-radius:10px;box-shadow:0 0 12px #999;
 text-align:center;
}
.grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;}
.bar{background:#cfe2f3;padding:10px;border-radius:6px;cursor:pointer;}
table{width:90%;margin:auto;border-collapse:collapse;}
th,td{border:1px solid #999;padding:6px;}
th{background:#0b5394;color:white;}
.adminOnly{display:none;}
</style>
</head>
<body>

<div class="header">
 <h2>RBS Institutions - Student Details</h2>
</div>

<div class="box">
<h3>Class Wise Students</h3>

<div id="allBar" class="bar adminOnly" onclick="showAll()">üìã All Students</div>
<br>
<div class="grid" id="classBars"></div>
<div id="list"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, onValue, push, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

// üîπ Your Firebase Config
const firebaseConfig = {
 apiKey: "AIzaSyDGMYTX20mKna9VGddgi6mCIyJkCgbJ7bA",
 authDomain: "rbs-institutions-portal.firebaseapp.com",
 databaseURL: "https://rbs-institutions-portal-default-rtdb.firebaseio.com",
 projectId: "rbs-institutions-portal",
 storageBucket: "rbs-institutions-portal.firebasestorage.app",
 messagingSenderId: "881467222162",
 appId: "1:881467222162:web:7acd765c4f7490ea6b9e4b"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const studentsRef = ref(db, "students");

let isAdmin = localStorage.getItem("isAdmin")==="true";
if(isAdmin) document.querySelectorAll(".adminOnly").forEach(e=>e.style.display="block");

// Create class bars
for(let i=1;i<=10;i++){
 classBars.innerHTML+=`<div class="bar" onclick="showClass(${i})">${i} Class</div>`;
}

window.showClass = function(cls){
 const classRef = ref(db, "students/"+cls);
 onValue(classRef, (snap)=>{
   let data = snap.val() || {};
   let keys = Object.keys(data);
   let html=`<h3>${cls} Class Students</h3>`;

   if(keys.length==0) html+="<p>No students</p>";
   else{
     html+=`<table><tr><th>S.No</th><th>Name</th><th>Roll</th>${isAdmin?"<th>Action</th>":""}</tr>`;
     keys.forEach((k,i)=>{
       let s=data[k];
       html+=`<tr>
         <td>${i+1}</td>
         <td>${s.name}</td>
         <td>${s.roll}</td>
         ${isAdmin?`<td><button onclick="delStudent('${cls}','${k}')">‚ùå</button></td>`:""}
       </tr>`;
     });
     html+="</table>";
   }

   if(isAdmin){
     html+=`<br>
       <input id="n" placeholder="Name">
       <input id="r" placeholder="Roll">
       <button onclick="addStudent(${cls})">Add</button>`;
   }
   list.innerHTML=html;
 });
}

window.addStudent = function(cls){
 let name=document.getElementById("n").value;
 let roll=document.getElementById("r").value;
 if(name && roll){
   const classRef = ref(db, "students/"+cls);
   push(classRef,{name,roll});
 }
}

window.delStudent = function(cls,key){
 const sRef = ref(db,"students/"+cls+"/"+key);
 remove(sRef);
}

window.showAll = function(){
 onValue(studentsRef,(snap)=>{
   let data=snap.val()||{};
   let html="<h3>All Students</h3>";
   html+=`<table><tr><th>Class</th><th>Name</th><th>Roll</th></tr>`;
   for(let c in data){
     Object.values(data[c]).forEach(s=>{
       html+=`<tr><td>${c}</td><td>${s.name}</td><td>${s.roll}</td></tr>`;
     });
   }
   html+="</table>";
   list.innerHTML=html;
 });
}
</script>

</body>
</html>
